#!/bin/bash --login

PID=<%= app.run_path %>/<%= @init_script %>.pid
CMD="<%= @daemon.command %>"

if [ `whoami` != "<%= app.user.name %>" ]; then
    echo >&2 "Must be run by user '<%= app.user.name %>'" && whoami && exit 1
fi

source <%= app.user.home %>/.bashrc
cd <%= app.current_path %> || exit 1

case $1 in
    start)
        echo "Starting <%= @init_script %>"
        $CMD &
        echo $! > $PID
        ;;
    stop)
        kill `cat $PID`
        ;;
    restart)
        kill `cat $PID`
        $CMD &
        echo $! > $PID
        ;;
    *)
        echo "usage: <%= @init_script %> {start|stop|restart}"
        ;;
esac