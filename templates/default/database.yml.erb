<% a = {app.environment=> @db_conf.clone} %>
<% if app[:postgresql] && app.postgresql[:nodes] %>
  <% app.postgresql[:nodes].each do |host| %>
    <% role = app.private_ip==host ? app.postgresql[:replication] : (app.postgresql[:replication]=='master' ? 'slave': 'master') %>
    <% a["#{app.environment}_#{role}"] = @db_conf.clone %>
    <% a["#{app.environment}_#{role}"]['host'] = host %>
  <% end %>
<% end %>
<%= YAML.dump(a)%>